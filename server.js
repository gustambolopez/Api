const express=require("express");require("dotenv").config();const app=express(),PORT=process.env.PORT||3e3,DISCORD_TOKEN=process.env.DISCORD_TOKEN,DISCORD_API="https://discord.com/api/v10",LANYARD_API="https://api.lanyard.rest/v1/users/";DISCORD_TOKEN||(console.error("missing bot token lil bro"),process.exit(1)),app.use(express.json());const fetchFromDiscord=async s=>{const a=await fetch(`${DISCORD_API}${s}`,{headers:{Authorization:`Bot ${DISCORD_TOKEN}`,"Content-Type":"application/json"}});if(!a.ok){const s=await a.text();throw new Error(s||"api error")}return a.json()};app.get("/v0/user/userid=:userId",(async(s,a)=>{const{userId:e}=s.params;try{const s=await fetchFromDiscord(`/users/${e}`);let t=null;try{const s=await fetch(`${LANYARD_API}${e}`),a=await s.json();t=a?.data||null}catch(s){}a.json({userId:s.id,username:s.username,discriminator:s.discriminator,globalName:s.global_name||null,avatarUrl:s.avatar?`https://cdn.discordapp.com/avatars/${s.id}/${s.avatar}.png`:null,bannerUrl:s.banner?`https://cdn.discordapp.com/banners/${s.id}/${s.banner}.png`:null,pronouns:s.pronouns||null,bio:s.bio||null,accentColor:s.accent_color||null,flags:s.flags||null,publicFlags:s.public_flags||null,premiumType:s.premium_type||null,avatarDecorationData:s.avatar_decoration_data||null,system:s.system||null,bot:s.bot||null,badges:t?.badges||null,premiumSince:t?.premium_since||null,mfaEnabled:t?.mfa_enabled||null,clan:t?.clan||null,lanyard:t||null,accurate:!0,status:t?.discord_status||"unknown",activities:t?.activities||[]})}catch(s){a.status(500).json({error:"Could not get user",details:s.message})}})),app.get("/v0/bot/guilds",(async(s,a)=>{try{const s=await fetchFromDiscord("/users/@me/guilds");a.json(s)}catch(s){a.status(500).json({error:"Could not get guilds",details:s.message})}})),app.get("/v0/guilds/:guildId",(async(s,a)=>{try{const e=await fetchFromDiscord(`/guilds/${s.params.guildId}`);a.json(e)}catch(s){a.status(500).json({error:"failed to fetch the guild",details:s.message})}})),app.get("/v0/channels/:channelId",(async(s,a)=>{try{const e=await fetchFromDiscord(`/channels/${s.params.channelId}`);a.json(e)}catch(s){a.status(500).json({error:"failed to get the channel",details:s.message})}})),app.get("/v0/channels/:channelId/messages",(async(s,a)=>{const{channelId:e}=s.params,t=new URLSearchParams(s.query).toString();try{const s=await fetchFromDiscord(`/channels/${e}/messages${t?"?"+t:""}`);a.json(s)}catch(s){a.status(500).json({error:"get messages failed",details:s.message})}})),app.get("/v0/channels/:channelId/messages/:messageId",(async(s,a)=>{const{channelId:e,messageId:t}=s.params;try{const s=await fetchFromDiscord(`/channels/${e}/messages/${t}`);a.json(s)}catch(s){a.status(500).json({error:"message couldnt be found",details:s.message})}})),app.get("/v0/guilds/:guildId/members/:userId",(async(s,a)=>{const{guildId:e,userId:t}=s.params;try{const s=await fetchFromDiscord(`/guilds/${e}/members/${t}`);a.json(s)}catch(s){a.status(500).json({error:"member not found",details:s.message})}})),app.get("/v0/guilds/:guildId/members",(async(s,a)=>{const{guildId:e}=s.params,t=new URLSearchParams(s.query).toString();try{const s=await fetchFromDiscord(`/guilds/${e}/members${t?"?"+t:""}`);a.json(s)}catch(s){a.status(500).json({error:"Member list fetch failed",details:s.message})}})),app.get("/v0/guilds/:guildId/roles",(async(s,a)=>{try{const e=await fetchFromDiscord(`/guilds/${s.params.guildId}/roles`);a.json(e)}catch(s){a.status(500).json({error:"cannot get role",details:s.message})}})),app.get("/v0/guilds/:guildId/emojis",(async(s,a)=>{try{const e=await fetchFromDiscord(`/guilds/${s.params.guildId}/emojis`);a.json(e)}catch(s){a.status(500).json({error:"cannot get emojis",details:s.message})}})),app.get("/v0/applications/:applicationId/commands",(async(s,a)=>{try{const e=await fetchFromDiscord(`/applications/${s.params.applicationId}/commands`);a.json(e)}catch(s){a.status(500).json({error:"cannot get bot commands",details:s.message})}})),app.get("/v0/applications/:applicationId/guilds/:guildId/commands",(async(s,a)=>{const{applicationId:e,guildId:t}=s.params;try{const s=await fetchFromDiscord(`/applications/${e}/guilds/${t}/commands`);a.json(s)}catch(s){a.status(500).json({error:"cannot get guild commands ",details:s.message})}})),app.listen(PORT,(()=>{console.log(`Server listening on http://localhost:${PORT}`)}));
